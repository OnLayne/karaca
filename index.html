<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teknik Servis Formu</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f2f2f2;
  padding:10px;
}
.form{
  background:#fff;
  max-width:850px;
  margin:auto;
  padding:15px;
}
.header{
  text-align:center;
  border-bottom:2px solid #000;
  padding-bottom:8px;
}
.header img{
  height:55px;
  margin-bottom:5px;
}
.header h1{margin:0;font-size:18px}
.header h2{margin:3px 0 0;font-size:13px}

.info{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  font-size:12px;
  margin:6px 0;
}

.section{
  border:1px solid #000;
  padding:8px;
  margin-top:8px;
}

label{
  font-weight:bold;
  font-size:12px;
  margin-top:6px;
  display:block;
}
input, textarea, select{
  width:100%;
  padding:6px;
  font-size:12px;
  margin-top:3px;
}

button{
  width:100%;
  margin-top:8px;
  padding:10px;
  font-size:14px;
}

canvas{
  border:1px solid #000;
  width:100%;
  max-width:300px;
  height:120px;
  touch-action:none;
}

/* PDF ŞABLONU */
#pdfForm{
  display:none;
  font-size:12px;
}
.pdf-row{margin-bottom:5px}
.pdf-label{font-weight:bold}
.pdf-uyari{
  font-size:10px;
  line-height:1.3;
  margin-top:8px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}
th,td{
  border:1px solid #000;
  padding:4px;
  text-align:center;
}
</style>
</head>

<body>

<!-- ================== FORM (EKRAN) ================== -->
<div id="form" class="form">

<div class="header">
  <img src="assets/logo.png">
  <h1>GEZİCİ BÖLGE MERKEZ SERVİS</h1>
  <h2>TEKNİK SERVİS FORMU</h2>
</div>

<div class="info">
  <div>Servis No: <span id="servisno"></span></div>
  <div>Tarih: <span id="tarih"></span></div>
  <div>Teknisyen Kodu: <strong id="teknisyen"></strong></div>
</div>

<div class="section">
<label>Müşteri Ad Soyad</label>
<input id="musteri">

<label>Adres</label>
<textarea id="adres"></textarea>

<label>Cihaz / Model</label>
<input id="cihaz">
</div>

<div class="section">
<label>Yapılan İşlem</label>
<select id="islem">
  <option>Yerinde Bakım Yapıldı</option>
  <option>Atölyeye Alındı</option>
  <option>Parça Değişimi Yapıldı</option>
</select>

<label>Yapılan İşlemler</label>
<textarea id="islemDetay"></textarea>

<label>Müşteriye Verilen Fiyat (₺)</label>
<input id="fiyat">

<button type="button" onclick="olusturIslem()">İşlem Metni Oluştur</button>

<div id="islemCikti" style="margin-top:8px;font-size:12px"></div>
</div>

<div class="section">
<label>Ödeme Şekli</label>
<select id="odeme">
  <option>Nakit</option>
  <option>EFT</option>
  <option>Kredi Kartı</option>
</select>

<label>Tutar</label>
<input id="tutar">

<button type="button" onclick="odemeEkle()">Ödeme Ekle</button>

<table>
<thead>
<tr><th>Tarih</th><th>Ödeme</th><th>Tutar</th></tr>
</thead>
<tbody id="odemeTablo"></tbody>
</table>
</div>

<div class="section">
<label>Müşteri İmzası</label>
<canvas id="imza"></canvas>
<button type="button" onclick="temizleImza()">İmzayı Temizle</button>
</div>

</div>

<button onclick="pdfOlustur()">PDF YAZDIR</button>

<!-- ================== PDF ŞABLONU ================== -->
<div id="pdfForm">
<h3 style="text-align:center;margin:0">
GEZİCİ BÖLGE MERKEZ SERVİS<br>
TEKNİK SERVİS FORMU
</h3>
<hr>

<div class="pdf-row"><span class="pdf-label">Müşteri:</span> <span id="p_musteri"></span></div>
<div class="pdf-row"><span class="pdf-label">Adres:</span> <span id="p_adres"></span></div>
<div class="pdf-row"><span class="pdf-label">Cihaz:</span> <span id="p_cihaz"></span></div>

<br>

<div class="pdf-label">Yapılan İşlem</div>
<div id="p_islem"></div>

<br>

<table>
<thead>
<tr><th>Tarih</th><th>Ödeme</th><th>Tutar</th></tr>
</thead>
<tbody id="p_odeme"></tbody>
</table>

<br>

<img id="p_imza" style="width:200px;border:1px solid #000">

<div class="pdf-uyari">
Yapılan servis ve onarım işlemleri, teslim tarihinden itibaren bir (1) yıl süre ile garanti kapsamındadır.
Ön ödeme ile işleme alınan cihazlarda, onarımdan vazgeçilmesi halinde ücret iadesi yapılmaz.
</div>
</div>

<script>
/* BİLGİLER */
document.getElementById("servisno").innerText="SRV-"+Date.now();
document.getElementById("tarih").innerText=new Date().toLocaleDateString("tr-TR");
document.getElementById("teknisyen").innerText=Math.floor(10000000+Math.random()*90000000);

/* İŞLEM METNİ */
function olusturIslem(){
  document.getElementById("islemCikti").innerHTML =
    "<strong>"+islem.value+"</strong><br>"+islemDetay.value+
    "<br><strong>Fiyat:</strong> "+fiyat.value+" TL";
}

/* ÖDEME */
function odemeEkle(){
  odemeTablo.innerHTML +=
    "<tr><td>"+tarih.innerText+"</td><td>"+odeme.value+"</td><td>"+tutar.value+" TL</td></tr>";
}

/* PDF */
function pdfOlustur(){
  p_musteri.innerText=musteri.value;
  p_adres.innerText=adres.value;
  p_cihaz.innerText=cihaz.value;
  p_islem.innerHTML=islemCikti.innerHTML;
  p_odeme.innerHTML=odemeTablo.innerHTML;
  p_imza.src=imza.toDataURL();

  form.style.display="none";
  pdfForm.style.display="block";

  html2pdf().set({
    margin:8,
    filename:"servis-formu.pdf",
    html2canvas:{scale:2},
    jsPDF:{format:"a4"}
  }).from(pdfForm).save().then(()=>{
    form.style.display="block";
    pdfForm.style.display="none";
  });
}

/* İMZA – iOS */
const c=imza,ctx=c.getContext("2d");let d=false;
function pos(e){const r=c.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}
c.addEventListener("mousedown",e=>{d=true;let p=pos(e);ctx.beginPath();ctx.moveTo(p.x,p.y)});
c.addEventListener("mousemove",e=>{if(d){let p=pos(e);ctx.lineTo(p.x,p.y);ctx.stroke()}});
c.addEventListener("mouseup",()=>d=false);
c.addEventListener("touchstart",e=>{d=true;let p=pos(e);ctx.beginPath();ctx.moveTo(p.x,p.y)});
c.addEventListener("touchmove",e=>{if(d){e.preventDefault();let p=pos(e);ctx.lineTo(p.x,p.y);ctx.stroke()}});
c.addEventListener("touchend",()=>d=false);
function temizleImza(){ctx.clearRect(0,0,c.width,c.height)}
</script>

</body>
</html>
